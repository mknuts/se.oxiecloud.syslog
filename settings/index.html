<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="/homey.js" data-origin="settings"></script>
  <style>
    /* Centrerar knapp-containern och lägger lite mellanrum mellan knapparna */
    .homey-form-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* För att dropdown-menyn ska se likadan ut som textfälten */
    select.homey-form-input {
      width: 100%;
    }
  </style>
</head>
<body class="homey-visual-baseline">
  <header class="homey-header">
    <h1 class="homey-title" data-i18n="settings.title">Syslog Settings</h1>
    <p class="homey-subtitle" data-i18n="settings.intro"></p>
  </header>

  <fieldset class="homey-form-fieldset">
    <div class="homey-form-group">
      <label class="homey-label" for="syslogHost" data-i18n="settings.hostLabel"></label>
      <input class="homey-form-input" id="syslogHost" type="text" placeholder="192.168.1.100" />
    </div>

    <div class="homey-form-group">
      <label class="homey-label" for="syslogPort" data-i18n="settings.portLabel"></label>
      <input class="homey-form-input" id="syslogPort" type="number" placeholder="514" />
    </div>

    <div class="homey-form-group">
      <label class="homey-label" for="syslogProtocol" data-i18n="settings.protocolLabel">Protocol</label>
      <select class="homey-form-input" id="syslogProtocol">
        <option value="udp">UDP</option>
        <option value="tcp">TCP</option>
      </select>
    </div>
  </fieldset>

  <div class="homey-form-buttons">
    <button id="test" class="homey-button-secondary" data-i18n="settings.test">Send Test Message</button>
    <button id="save" class="homey-button-primary" data-i18n="settings.save">Save Settings</button>
  </div>

  <script type="text/javascript">
    function onHomeyReady(Homey) {
      const hostInput = document.getElementById('syslogHost');
      const portInput = document.getElementById('syslogPort');
      const protocolInput = document.getElementById('syslogProtocol');
      const saveBtn = document.getElementById('save');
      const testBtn = document.getElementById('test');

      // Hämta sparade värden
      Homey.get('syslogHost', (err, value) => { if (value) hostInput.value = value; });
      Homey.get('syslogPort', (err, value) => { if (value) portInput.value = value; });
      Homey.get('syslogProtocol', (err, value) => { if (value) protocolInput.value = value; });

      // Vid spara
      saveBtn.addEventListener('click', () => {
        const host = hostInput.value;
        const port = portInput.value;
        const protocol = protocolInput.value;

        Homey.set('syslogHost', host);
        Homey.set('syslogPort', port);
        Homey.set('syslogProtocol', protocol);
        
        Homey.alert(Homey.__('settings.saved')); 
      });

      // Vid test
      testBtn.addEventListener('click', () => {
        Homey.api('POST', '/testConnection', {})
          .then(() => {
            Homey.alert(Homey.__('settings.testSuccess'));
          })
          .catch(err => {
            Homey.alert(Homey.__('settings.testError') + ': ' + err);
          });
      });

      Homey.ready();
    }
  </script>
</body>
</html>